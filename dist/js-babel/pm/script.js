'use strict';var pMachine=pMachine||{};(function(a){function b(a){return a.originalEvent&&a.originalEvent.touches}function c(a){return physii.math.loneRanger(a,-Math.PI,Math.PI,0,2*Math.PI)}function d(a){var b=c(a);return b=physii.math.loneRanger(b,Math.PI/4,7*Math.PI/4,0,1),b}function e(a){var b=physii.math.loneRanger(a,0,1,Math.PI/4,7*Math.PI/4),c=physii.math.loneRanger(b,0,2*Math.PI,-Math.PI,Math.PI);return c}function f(a,b){if(p){var c=p,e=c.width(),f=c.height(),g=0,i=0,j=c[0].getBoundingClientRect(),e=j.width,f=j.height,k=c.offset();g=a-(k.left+e/2),i=b-(k.top+f/2);var m=-i,n=g,o=Math.atan2(n,m),q=d(o),r=c.attr("id");if("pm-control-uppers"===r){var s=physii.math.loneRanger(q,0,1,-30,0);q=h(s)}l(r,q),o>3*Math.PI/4?o=3*Math.PI/4:o<-3*Math.PI/4&&(o=-3*Math.PI/4),c.css("transform","translate(-50%, -50%)  rotate("+o+"rad)")}}function g(){var b=["pm-control-uppers","pm-control-downers"];a.currentVibe=m("currentVibe");for(var c=0;c<b.length;c++){var d=b[c],f=$("#"+d),g=m(d);s&&s.handleFloat(d,g,1),"pm-control-uppers"===d&&(g=j(g,-30,0));var h=e(g);f.css("transform","translate(-50%, -50%)  rotate("+h+"rad)")}}function h(a){var b=Math.pow(10,a/20);return b}function j(a,b,c){var d=k(a);return d=physii.math.loneRanger(d,b,c,0,1),d}function k(a){return 20*Math.log10(a)}function l(a,b){t.setItem(a,JSON.stringify(b)),s&&s.handleFloat(a,b,.01)}function m(a){var b=JSON.parse(t.getItem(a));return b}function n(){var b=o(a.currentVibe);v&&v.destroy(),v=new Swiper(".swiper-container",{direction:"horizontal",autoHeight:!0,pagination:{el:".swiper-pagination"},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},initialSlide:b}),v.on("slideChange",function(){console.log("slide changed",v.realIndex,a.config.vibes[v.realIndex]);var b=a.config.vibes[v.realIndex];a.currentVibe=b.id,l("currentVibe",a.currentVibe),s.selectVibe(a.currentVibe)})}function o(b){var c=a.config.vibes.findIndex(function(a){return a.id===b});return c}a.config={default_vibe:"beige_haze",vibes:[{id:"beige_haze",text:"Beige Haze",img:"sunset-1.jpg",audio:"beige_haze"},{id:"ocean_beach",text:"Ocean Beach",img:"beach.jpg",audio:"ocean-1.wav"},{id:"zabriskie_point",text:"Zabriskie Point",img:"desert.jpg",audio:"desert-loop-1.wav"},{id:"rabbit_hole",text:"Rabbit Hole",img:"garden.jpg",audio:"garden-1.wav"},{id:"bummer_trip",text:"Bummer Trip",img:"bummer-trip.jpg",audio:"bummer-trip-1.wav"}]},a.currentVibe=a.config.default_vibe;var p=null,q=0,r=0,s=window.PeaceMachineInterface||pMachine.audio,t=window.localStorage,u=null;$(function(){u=$(".rotatable"),u.bind("mousedown touchstart",function(a){a.stopPropagation(),a.preventDefault(),p=$(a.target)}),u.bind("touchend",function(a){a.stopPropagation(),p=null}),$(document.body).bind("mousemove touchmove",function(a){var c=a;b(a)&&(c=a.originalEvent.touches[0]),q=c.pageX,r=c.pageY,f(q,r),a.stopPropagation()}),$(document.body).bind("mouseup mouseleave",function(){p=null})}),a.turnOn=function(){s.turnOn(),g();var a=$(".pm-landing");a.fadeOut(1e3,function(){a.hide()})},a.handleTurnOn=function(){s.selectVibe(a.currentVibe)},a.dropOut=function(){s.turnOff();var a=$(".pm-landing");a.fadeIn(1600,function(){a.show()})};var v=null;a.tuneIn=function(){var a=$(".pm-landing"),b=$(".pm-tune-in");b.css("opacity",0),b.show(),n(),b.animate({opacity:1},1e3,function(){a.hide()})},a.tuneOut=function(){var a=$(".pm-tune-in");setTimeout(function(){a.hide()},1e3),a.animate({opacity:0},1200)},a.getVibesConfig=function(){return JSON.stringify(a.config.vibes)},s.initAudio(),g()})(pMachine);