'use strict';var pMachine=pMachine||{};(function(a){function b(a){return a.originalEvent&&a.originalEvent.touches}function c(a){return physii.math.loneRanger(a,-Math.PI,Math.PI,0,2*Math.PI)}function d(a){var b=c(a);return b=physii.math.loneRanger(b,Math.PI/4,7*Math.PI/4,0,1),b}function e(a){var b=physii.math.loneRanger(a,0,1,Math.PI/4,7*Math.PI/4),c=physii.math.loneRanger(b,0,2*Math.PI,-Math.PI,Math.PI);return c}function f(a,b){if(q){var c=q,e=c.width(),f=c.height(),g=0,i=0,j=c[0].getBoundingClientRect(),e=j.width,f=j.height,k=c.offset();g=a-(k.left+e/2),i=b-(k.top+f/2);var m=-i,n=g,o=Math.atan2(n,m),p=d(o),r=c.attr("id");if("pm-control-uppers"===r){var s=physii.math.loneRanger(p,0,1,-30,0);p=h(s)}l(r,p),o>3*Math.PI/4?o=3*Math.PI/4:o<-3*Math.PI/4&&(o=-3*Math.PI/4),c.css("transform","translate(-50%, -50%)  rotate("+o+"rad)")}}function g(){var b=["pm-control-uppers","pm-control-downers"];a.currentVibe=m("currentVibe");for(var c=0;c<b.length;c++){var d=b[c],f=$("#"+d),g=m(d);t&&t.handleFloat(d,g,1),"pm-control-uppers"===d&&(g=j(g,-30,0));var h=e(g);f.css("transform","translate(-50%, -50%)  rotate("+h+"rad)")}}function h(a){var b=Math.pow(10,a/20);return b}function j(a,b,c){var d=k(a);return d=physii.math.loneRanger(d,b,c,0,1),d}function k(a){return 20*Math.log10(a)}function l(a,b){u.setItem(a,JSON.stringify(b)),t&&t.handleFloat(a,b,.01)}function m(a){var b=JSON.parse(u.getItem(a));return b}function n(){var b=o(a.currentVibe);w&&w.destroy(),w=new Swiper(".swiper-container",{direction:"horizontal",autoHeight:!0,pagination:{el:".swiper-pagination"},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},initialSlide:b}),w.on("slideChange",function(){console.log("slide changed",w.realIndex,a.config.vibes[w.realIndex]);var b=a.config.vibes[w.realIndex];a.currentVibe=b.id,l("currentVibe",a.currentVibe),t.selectVibe(a.currentVibe)})}function o(b){var c=a.config.vibes.findIndex(function(a){return a.id===b});return c}a.config={default_vibe:"beige_haze",vibes:[{id:"beige_haze",text:"Beige Haze",img:"sunset-1.jpg",audio:"beige_haze"},{id:"ocean_beach",text:"Ocean Beach",img:"beach.jpg",audio:"ocean-1.wav"},{id:"zabriskie_point",text:"Zabriskie Point",img:"desert.jpg",audio:"desert-loop-1.wav"},{id:"rabbit_hole",text:"Rabbit Hole",img:"garden.jpg",audio:"garden-1.wav"},{id:"bummer_trip",text:"Bummer Trip",img:"bummer-trip.jpg",audio:"bummer-trip-1.wav"}],page_fade_time:1200};var p=a.config.page_fade_time;a.currentVibe=a.config.default_vibe;var q=null,r=0,s=0,t=window.PeaceMachineInterface||pMachine.audio,u=window.localStorage,v=null;$(function(){v=$(".rotatable"),v.bind("mousedown touchstart",function(a){a.stopPropagation(),a.preventDefault(),q=$(a.target)}),v.bind("touchend",function(a){a.stopPropagation(),q=null}),$(document.body).bind("mousemove touchmove",function(a){var c=a;b(a)&&(c=a.originalEvent.touches[0]),r=c.pageX,s=c.pageY,f(r,s),a.stopPropagation()}),$(document.body).bind("mouseup mouseleave",function(){q=null})}),a.turnOn=function(){t.turnOn(),g();var a=$(".pm-landing"),b=$("#pm-main-page");b.css("opacity",0),b.css("display",""),b.addClass("pm-top-page"),a.removeClass("pm-top-page"),a.fadeOut(p,function(){a.hide()}),b.animate({opacity:1},p)},a.handleTurnOn=function(){t.selectVibe(a.currentVibe)},a.dropOut=function(){t.turnOff();var a=$(".pm-landing"),b=$("#pm-main-page");a.css("opacity",0),a.css("display",""),a.addClass("pm-top-page"),b.removeClass("pm-top-page").addClass("pm-middle-page"),a.animate({opacity:1},p)};var w=null;a.tuneIn=function(){var a=$(".pm-landing"),b=$(".pm-tune-in"),c=$("pm-main-page");c.removeClass("pm-top-page").addClass("pm-middle-page"),b.css("opacity",0),b.addClass("pm-top-page"),b.show(),n(),b.animate({opacity:1},p,function(){a.hide()})},a.tuneOut=function(){var a=$(".pm-tune-in"),b=$("#pm-main-page");b.css("opacity",0),b.addClass("pm-top-page"),a.removeClass("pm-top-page").addClass("pm-middle-page"),setTimeout(function(){a.hide()},p),a.animate({opacity:0},p),b.animate({opacity:1},p)},a.getVibesConfig=function(){return JSON.stringify(a.config.vibes)},t.initAudio(),g()})(pMachine);