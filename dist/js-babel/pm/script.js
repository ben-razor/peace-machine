'use strict';var pMachine=pMachine||{};(function(a){function b(a){return a.originalEvent&&a.originalEvent.touches}function c(a){return physii.math.loneRanger(a,-Math.PI,Math.PI,0,2*Math.PI)}function d(a){var b=c(a);return b=physii.math.loneRanger(b,Math.PI/4,7*Math.PI/4,0,1),b}function e(a){var b=physii.math.loneRanger(a,0,1,Math.PI/4,7*Math.PI/4),c=physii.math.loneRanger(b,0,2*Math.PI,-Math.PI,Math.PI);return c}function f(a,b){if(r){var c=r,e=c.width(),f=c.height(),g=0,i=0,j=c[0].getBoundingClientRect(),e=j.width,f=j.height,k=c.offset();g=a-(k.left+e/2),i=b-(k.top+f/2);var l=-i,n=g,o=Math.atan2(n,l),p=d(o),q=c.attr("id");if("pm-control-uppers"===q){var s=h(-42),t=physii.math.loneRanger(p,0,1,-42,0);p=h(t),.001>p-s&&(p=0)}m(q,p),o>3*Math.PI/4?o=3*Math.PI/4:o<-3*Math.PI/4&&(o=-3*Math.PI/4),c.css("transform","translate(-50%, -50%)  rotate("+o+"rad)")}}function g(){var b=["pm-control-uppers","pm-control-downers"];a.currentVibe=n("currentVibe");for(var c=0;c<b.length;c++){var d=b[c],f=$("#"+d),g=n(d);u&&u.handleFloat(d,g,1),"pm-control-uppers"===d&&(g=j(g,-42,0));var h=e(g);f.css("transform","translate(-50%, -50%)  rotate("+h+"rad)")}}function h(a){var b=Math.pow(10,a/20);return b}function j(a,b,c){var d=l(a);return d=physii.math.loneRanger(d,b,c,0,1),d}function k(a,b,c){var d=physii.math.loneRanger(a,0,1,b,c),e=h(d);return e}function l(a){return 20*Math.log10(a)}function m(a,b){console.log(a,b),v.setItem(a,JSON.stringify(b)),u&&u.handleFloat(a,b,.01)}function n(b){var c=JSON.parse(v.getItem(b));return null===c&&("currentVibe"===b&&(c=a.config.default_vibe),"pm-control-downers"===b?c=a.config.default_downers:"pm-control-uppers"==b&&(c=k(a.config.default_uppers,-42,0))),c}function o(){var b=p(a.currentVibe);x&&x.destroy(),x=new Swiper(".swiper-container",{direction:"horizontal",autoHeight:!0,pagination:{el:".swiper-pagination"},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},initialSlide:b}),x.on("slideChange",function(){console.log("slide changed",x.realIndex,a.config.vibes[x.realIndex]);var b=a.config.vibes[x.realIndex];a.currentVibe=b.id,m("currentVibe",a.currentVibe),u.selectVibe(a.currentVibe)})}function p(b){var c=a.config.vibes.findIndex(function(a){return a.id===b});return c}a.config={default_vibe:"beige_haze",vibes:[{id:"beige_haze",text:"Beige Haze",img:"sunset-1.jpg",audio:"beige_haze"},{id:"ocean_beach",text:"Ocean Beach",img:"beach.jpg",audio:"ocean-1.wav"},{id:"zabriskie_point",text:"Zabriskie Point",img:"desert.jpg",audio:"desert-loop-1.wav"},{id:"rabbit_hole",text:"Rabbit Hole",img:"garden.jpg",audio:"garden-1.wav"},{id:"bummer_trip",text:"Bummer Trip",img:"bummer-trip.jpg",audio:"bummer-trip-1.wav"}],page_fade_time:1200,default_downers:1,default_uppers:.5};var q=a.config.page_fade_time;a.currentVibe=a.config.default_vibe;var r=null,s=0,t=0,u=window.PeaceMachineInterface||pMachine.audio,v=window.localStorage,w=null;$(function(){w=$(".rotatable"),w.bind("mousedown touchstart",function(a){a.stopPropagation(),a.preventDefault(),r=$(a.target)}),w.bind("touchend",function(a){a.stopPropagation(),r=null}),$(document.body).bind("mousemove touchmove",function(a){var c=a;b(a)&&(c=a.originalEvent.touches[0]),s=c.pageX,t=c.pageY,f(s,t),a.stopPropagation()}),$(document.body).bind("mouseup mouseleave",function(){r=null})}),a.dBToMul=h,a.valToMul=k,a.turnOn=function(){u.turnOn(),g();var a=$(".pm-landing"),b=$("#pm-main-page");b.stop(),a.stop(),b.css("opacity",0),b.css("display",""),b.addClass("pm-top-page"),a.removeClass("pm-top-page"),a.fadeOut(q),b.animate({opacity:1},q)},a.handleTurnOn=function(){u.selectVibe(a.currentVibe)},a.dropOut=function(){u.turnOff();var a=$(".pm-landing"),b=$("#pm-main-page");a.stop(),b.stop(),a.css("opacity",0),a.css("display",""),a.addClass("pm-top-page"),b.removeClass("pm-top-page").addClass("pm-middle-page"),a.animate({opacity:1},q)};var x=null;a.tuneIn=function(){var a=$(".pm-landing"),b=$(".pm-tune-in"),c=$("pm-main-page");a.stop(),b.stop(),c.stop(),c.removeClass("pm-top-page").addClass("pm-middle-page"),b.css("opacity",0),b.addClass("pm-top-page"),b.show(),o(),b.animate({opacity:1},q)},a.tuneOut=function(){var a=$(".pm-tune-in"),b=$("#pm-main-page");a.stop(),b.stop(),b.css("opacity",0),b.addClass("pm-top-page"),a.removeClass("pm-top-page").addClass("pm-middle-page"),a.animate({opacity:0},q),b.animate({opacity:1},q)},a.getVibesConfig=function(){return JSON.stringify(a.config.vibes)},a.handleVibeCreated=function(b){b===a.currentVibe&&u.selectVibe(b)},u.initAudio(),g()})(pMachine);